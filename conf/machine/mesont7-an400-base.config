#@TYPE: Machine
#@NAME: meson

#@DESCRIPTION: Machine configuration for meson systems

include conf/machine/include/mesont7_k5.4_64b.inc

KERNEL_DEVICETREE = "t7_a311d2_an400_linux.dtb"
UBOOT_MACHINE = "t7_an400_lpddr4x_config"

DISTRO_FEATURES_append = " alsa "
DISTRO_FEATURES_BACKFILL_CONSIDERED = "sysvinit"
DEFAULT_DISTRO_FEATURES += " systemd"
DISTRO_FEATURES_append = " systemd"
DISTRO_FEATURES_remove = " sysvinit"
DISTRO_FEATURES_remove = " opengl"
DISTRO_FEATURES_append = " gstreamer1"

DISTRO_FEATURES_remove = " mesa mesa-gl x11"
DISTRO_FEATURES_remove = " cairo"
DISTRO_FEATURES_remove = " wayland"
DISTRO_FEATURES_NATIVESDK_remove = "x11"

RDEPENDS_packagegroup-amlogic-baserootfs_remove = "aml-provision aml-libdvr aml-mp-sdk aml-cas-hal aml-pqserver aml-hdcp aml-hdcp-load-firmware"
RDEPENDS_packagegroup-amlogic-baserootfs_remove = "gst-plugin-aml-asink gst-aml-drm-plugins gstreamer1.0-libav gst-player"
#Remove netflix related
RDEPENDS_packagegroup-amlogic-baserootfs_remove = "netflix-aml wpeframework-plugin-netflix"
#Remove thunder framework related
RDEPENDS_packagegroup-amlogic-baserootfs_remove = "bluetooth-mgr bluetooth-core"

MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS_remove = "media-modules"


OVERRIDES .= ":an400:t7:onepass"
MACHINEOVERRIDES .= ":client"

EXTRA_BLUETOOTH_STUFF := "${@bb.utils.contains('DISTRO_FEATURES', 'bluetooth', bb.utils.contains('DISTRO_FEATURES', 'bluez5', ' bluez5', ' bluez4', d), '', d)}"
DISTRO_FEATURES_append = "${EXTRA_BLUETOOTH_STUFF}"

BBMASK += "meta-aml-netflix/recipes-netflix/netflix/netflix-aml_git.bb"
BBMASK += "meta-aml-netflix/recipes-netflix/wpeframework/wpeframework-plugin-netflix_git.bb"
